*Thinking...*

> The user wants me to create a complete markdown document series architecture for their "心情地圖" (Mood Map) SaaS product. This should be a comprehensive documentation structure covering all aspects of the product - from product vision, feature specs, technical architecture, API design, database schema, to deployment and business planning.
> 
> Let me create a thorough markdown documentation architecture/outline that they can use as a foundation for building out their product documentation.
> 
> This is a documentation/planning request, not a request for a visual tool, so I should provide it in markdown format as text, not as a rendered component.
> 
> Let me think about what a complete SaaS product documentation series would look like:

# 心情地圖 MoodMap — 完整產品文件架構

以下是整套文件系列的目錄與內容骨架，每份文件可獨立成一個 `.md` 檔案，放在專案的 `/docs` 目錄下統一管理。

---

## 📁 文件總覽目錄

```
docs/
├── 00-index.md                          # 文件總覽與導讀
├── 01-product-vision.md                 # 產品願景與核心理念
├── 02-user-research.md                  # 用戶研究與人物誌
├── 03-feature-spec.md                   # 功能規格書
├── 04-information-architecture.md       # 資訊架構與用戶流程
├── 05-technical-architecture.md         # 系統技術架構
├── 06-database-design.md               # 資料庫設計
├── 07-api-design.md                     # API 介面設計
├── 08-map-bindsualization.md          # 地圖與視覺化系統
├── 09-realtime-system.md               # 即時通訊與推播系統
├── 10-mood-aggregation-engine.md       # 心情聚合引擎
├── 11-content-moderation.md            # 內容審核與安全機制
├── 12-privacy-security.md              # 隱私權與資安策略
├── 13-devops-deployment.md             # DevOps 與部署策略
├── 14-analytics-metrics.md             # 數據分析與關鍵指標
├── 15-business-model.md                # 商業模式與變現策略
├── 16-go-to-market.md                  # 上市策略與成長計畫
├── 17-roadmap.md                       # 產品路線圖
└── appendix/
    ├── A-glossary.md                    # 術語表
    ├── B-mood-taxonomy.md               # 心情分類學定義
    ├── C-design-tokens.md               # 設計語彙 (色彩/字型/元件)
    └── D-competitive-analysis.md        # 競品分析
```

---

## 00 — 文件總覽與導讀

```markdown
# 心情地圖 MoodMap — 文件總覽

## 專案簡介
一句話描述：基於地理定位的匿名情緒社交平台，讓城市的心情被看見。

## 文件版本紀錄
| 版本 | 日期 | 作者 | 變更摘要 |
|------|------|------|----------|
| 0.1  | YYYY-MM-DD | — | 初稿建立 |

## 閱讀順序建議
- 產品角色 → 01 → 02 → 03 → 04
- 工程角色 → 05 → 06 → 07 → 08 → 09 → 10
- 營運角色 → 11 → 12 → 14 → 15 → 16

## 名詞約定
參見 `appendix/A-glossary.md`
```

---

## 01 — 產品願景與核心理念

```markdown
# 01 產品願景與核心理念

## 1.1 願景聲明 (Vision Statement)
<!-- 一段話描述產品終極想達成的世界 -->

## 1.2 問題陳述 (Problem Statement)
### 用戶痛點
- 現代人情緒孤島化，想表達但缺乏安全出口
- 社群媒體以身份為中心，發情緒文有社交壓力
- 缺乏「此刻、此地」的情緒共鳴感

### 市場缺口
- 匿名社交 × 地理資訊 × 情緒可視化的交叉領域尚無主導者

## 1.3 解決方案概述
<!-- MoodMap 如何解決上述問題 -->

## 1.4 核心價值主張 (Value Proposition)
- 對發文者：零壓力的情緒出口
- 對瀏覽者：感受城市的即時情緒脈搏
- 對社會：匿名聚合的情緒數據提供城市幸福感洞察

## 1.5 產品原則 (Design Principles)
0. **安全守護 — 保護用戶生命與心理健康是一切功能決策的最高優先級**
   - 任何功能上線前必須通過安全影響評估
   - 寧可誤擋也不漏放有害內容
   - 平台絕不容許任何可能導致自我傷害或煽動他人傷害的內容傳播
1. 匿名優先 — 安全感是表達的前提
2. 輕量互動 — 回應只需一個點擊
3. 即時在地 — 此刻此地才有意義
4. 視覺驅動 — 情緒用看的比用讀的更直覺
5. 善意引導 — 平台氛圍設計偏向溫暖支持

## 1.6 情緒安全聲明 (Emotional Safety Commitment)
MoodMap 致力於成為一個**安全的情緒表達空間**，我們承諾：
- 絕不允許任何鼓勵、美化、描述具體自殺/自傷方式的內容在平台上傳播
- 對於處於心理危機中的用戶，平台將主動提供即時關懷資源與專業求助管道
- 平台設計將主動降低「情緒傳染風險」，避免大量負面內容集中曝光對脆弱用戶造成二次傷害
- 所有安全防護機制必須在產品最初版本（Alpha）即完整上線，不得因功能排期而延後
- 定期邀請心理健康專業人士審核平台內容策略與安全機制

## 1.7 成功指標 (North Star Metric)
<!-- 例如：每週活躍發文用戶數 × 每則心情文的平均互動數 -->
```

---

## 02 — 用戶研究與人物誌

```markdown
# 02 用戶研究與人物誌

## 2.1 目標用戶族群
### 主要族群
- 18–35 歲都市生活者
- 情緒敏感但不善於在熟人社交圈表達

### 次要族群
- 城市旅行者 / 數位遊牧者
- 心理健康關注者

## 2.2 人物誌 (Personas)

### Persona A：小安 — 都市上班族
| 項目 | 描述 |
|------|------|
| 年齡 | 27 歲 |
| 職業 | 行銷企劃 |
| 痛點 | 加班後情緒低落，不想跟朋友抱怨又想被理解 |
| 動機 | 想在匿名環境抒發，知道有人感同身受就好 |
| 使用場景 | 深夜下班在捷運站，發一則「好累但撐過了」 |

### Persona B：阿凱 — 大學生
<!-- 同上格式 -->

### Persona C：Mia — 旅行者
<!-- 同上格式 -->

## 2.3 用戶旅程地圖 (User Journey Map)
### 新用戶首次體驗旅程
| 階段 | 觸點 | 行為 | 情緒 | 機會點 |
|------|------|------|------|--------|
| 發現 | App Store | 搜尋「匿名心情」 | 好奇 | ASO 關鍵字 |
| 註冊 | App | 匿名快速註冊 | 期待 | 降低門檻 |
| 首次瀏覽 | 地圖頁 | 看到附近心情氣泡 | 驚喜 | 引導互動 |
| 首次發文 | 發文頁 | 猶豫後發出第一則 | 緊張→釋放 | 發文後正向回饋 |
| 收到回應 | 通知 | 收到「抱抱」回應 | 溫暖 | 促進回訪 |

## 2.4 使用情境 (Use Cases)
<!-- 列出 8-10 個典型使用情境 -->
```

---

## 03 — 功能規格書

```markdown
# 03 功能規格書

## 3.1 功能架構總覽

### 核心功能 (P0 — MVP)
#### F-001 GPS 定位心情發文
- 描述：用戶在當前位置發出一則心情文
- 輸入：心情文字 (≤150字)、心情標籤 (單選)、定位精度選擇
- 輸出：地圖上出現一個心情氣泡
- 規則：
  - 每位用戶每小時最多發 3 則 (防刷)
  - 定位可選「精確」或「模糊 (街區級)」
  - 心情標籤基於情緒分類學 (見 appendix/B)
  - **安全規則（P0 硬需求）**：文字發送前必經即時四層安全掃描（詳見 Section 11），掃描延遲 ≤ 200ms，不得跳過

#### F-002 心情氣泡瀏覽
- 描述：用戶在地圖上瀏覽附近的心情氣泡
- 地圖縮放層級與顯示邏輯：
  - Zoom ≥ 15：顯示個別心情氣泡
  - Zoom 12–14：氣泡開始聚合為小型氣團
  - Zoom ≤ 11：完全聚合為區域心情氣象區塊
- 氣泡樣式根據心情標籤決定顏色與圖示

#### F-003 罐頭回應 / 表情回應 / 匿名短回覆
- 描述：對他人心情文進行輕量回應
- 回應類型（分層設計）：
  - **Level 1 — 一鍵回應（P0）**：
    - 預設罐頭文：「抱抱」「加油」「我懂」「一起吧」「辛苦了」
    - 表情符號：❤️ 🫂 💪 😢 🌈 ☀️
  - **Level 2 — 匿名短回覆（P1）**：
    - 50 字以內的自由文字回覆
    - 短回覆同樣需經即時安全掃描（Section 11 四層審核）
    - 提供更深的情感連結，強化留存
- 規則：每人對同一則心情文只能回應一次（罐頭與短回覆互斥，選一）
- 回應數會顯示在氣泡上

#### F-004 心情氣象區塊
- 描述：聚合展示區域整體情緒
- 視覺呈現：
  - 顏色色溫：暖色 = 正向高能、冷色 = 低落沉靜
  - 天氣圖示隱喻：☀️ 晴朗 / ⛅ 多雲 / 🌧 陰雨 / ⛈ 風暴 / 🌈 彩虹
  - 透明度反映資料密度（資料少 = 更透明）
- 點擊區塊可展開該區域的情緒摘要

#### F-013 安全防護系統 ⚠️
- **優先級：P0 — 與發文功能同等優先，MVP 必備**
- 描述：即時四層內容安全掃描 + 三級自殺/自傷響應協議 + 有害內容傳播阻斷
- 子系統：
  - 即時自動審核引擎（Layer 1-4，≤200ms）
  - 三級響應協議（紅/橙/黃警戒流程）
  - 硬性攔截規則引擎（具體手段描述、煽動內容零容忍）
  - 傳染效應防護（Werther Effect Prevention）
  - 瀏覽者保護（負面內容曝光限制、休息提醒）
  - 平台情緒安全儀表板（即時監控 + 自動應急）
- 依賴：NLP 模型、關鍵字庫、人工審核團隊
- 被依賴：F-001（發文）、F-003（回應）、所有涉及用戶生成內容的功能
- 詳見 Section 11

#### F-014 關懷資源中心
- **優先級：P0 — MVP 必備**
- 描述：App 內常駐的心理健康資源入口
- 功能：
  - 一鍵撥打生命線 (1925) / 安心專線 (1980)
  - 各地區在地化心理援助熱線（根據 GPS 定位自動匹配）
  - 線上文字危機諮詢連結
  - 心理健康知識庫（由合作專業機構提供）
  - 近期心理健康活動資訊
- 入口位置：底部導航列 / 設定頁 / 任何警戒觸發時的關懷卡片
- 資源準確性由專業機構定期審核

### 重要功能 (P1 — V1.1)
#### F-005 個人心情歷程
#### F-006 心情通知
#### F-007 匿名暱稱系統
#### F-008 心情篩選器

#### F-015 心情天氣分享卡片
- 描述：自動生成精美的情緒天氣分享圖，驅動病毒傳播
- 卡片類型：
  - **個人週報卡片**：「你這週的情緒天氣：多雲轉晴 ⛅→☀️」— 含一週情緒曲線視覺化
  - **城市即時天氣卡片**：「台北信義區現在的心情：☀️ 晴朗」— 含區域情緒分佈圖
  - **里程碑卡片**：「你已經連續記錄情緒 30 天」「你收到了第 100 個抱抱」
  - **節日特別版卡片**：跨年倒數、情人節、中秋節等主題設計
- 分享目標：IG Story、LINE、Facebook、Twitter、儲存至相簿
- 卡片設計：深色背景 + 品牌色 + 天氣動效，高辨識度且適合社群傳播
- 卡片底部固定顯示 MoodMap Logo + 下載引導文字
- **安全規則**：分享卡片不包含任何負面/高風險心情文原文內容

#### F-016 情緒日記連續紀錄
- 描述：溫和鼓勵用戶每日記錄情緒，養成習慣
- 機制：
  - 連續天數追蹤（非強制打卡，錯過不懲罰）
  - 溫和鼓勵語：「已經連續記錄 7 天了，你很棒 💙」
  - 可愛的成長視覺化：情緒花園 / 天氣日曆
  - 週末推送「本週回顧」摘要
- 設計原則：正向鼓勵型，不是壓力型打卡（斷了不會「歸零」，而是「歡迎回來」）

#### F-017 情緒共鳴推薦
- 描述：推薦附近與用戶心情相似的人，增強歸屬感
- 展現方式：
  - 發文後推送：「1.2km 外也有人和你一樣感覺 tired ⛅」
  - 地圖上用微光連線暗示附近有同頻的人（不揭露確切位置）
- 隱私保護：僅顯示模糊距離 + 情緒標籤，絕不揭露對方任何身份或精確位置
- **安全規則**：不推薦紅色/橙色警戒的心情文作為共鳴對象

### 進階功能 (P2 — V2.0)
#### F-009 心情趨勢分析 (個人)
#### F-010 城市心情報告 (公開)
#### F-011 心情串聯 (匿名對話)
#### F-012 品牌情緒打卡站

## 3.2 功能依賴矩陣
| 功能 | 依賴 | 被依賴 |
|------|------|--------|
| F-001 | GPS API, 用戶系統, **F-013** | F-002, F-003, F-004 |
| F-003 | F-001, **F-013 (短回覆審核)** | F-015 (互動數據) |
| F-004 | F-001, 聚合引擎 | F-010, F-015 |
| **F-013** | NLP 模型, 關鍵字庫 | **F-001, F-003, 所有 UGC 功能** |
| **F-014** | 心理機構合作資料 | F-013 (關懷卡片連結) |
| F-015 | F-004, F-005, F-016 | 成長/傳播 |
| F-016 | F-001, 用戶系統 | F-015, F-009 |
| F-017 | F-001, 聚合引擎 | 留存 |

## 3.3 非功能性需求
- 效能：地圖載入 < 2 秒，氣泡渲染 < 500ms
- 可用性：99.9% uptime
- 擴展性：支撐 10 萬 DAU 起步架構
- 無障礙：WCAG 2.1 AA 級
```

---

## 04 — 資訊架構與用戶流程

```markdown
# 04 資訊架構與用戶流程

## 4.1 應用程式結構 (App Sitemap)

首頁 (地圖)
├── 心情氣泡 → 氣泡詳情 → 回應面板
├── 氣象區塊 → 區域情緒摘要
├── 搜尋 / 篩選面板
└── 定位按鈕 → 回到當前位置

發文
├── 選擇心情標籤
├── 輸入心情文字
├── 定位精度選擇
└── 發送確認

我的
├── 心情歷程 (時間軸)
├── 收到的回應
├── 情緒趨勢圖表 (P2)
└── 設定
    ├── 隱私設定
    ├── 通知設定
    ├── 帳號管理
    └── 訂閱方案

## 4.2 核心用戶流程 (User Flows)

### Flow 1：發出心情文
<!-- 用文字描述或 Mermaid 流程圖 -->
開啟 App → 授權定位 → 點擊「+」→ 選擇心情標籤
→ 輸入文字 (選填) → 確認定位精度 → 發送
→ 動畫：氣泡從中心飄出 → 回到地圖

### Flow 2：瀏覽與回應
開啟 App → 瀏覽地圖 → 看到附近氣泡 → 點擊氣泡
→ 閱讀心情文 → 選擇罐頭回應 / 表情 → 回應成功動畫

### Flow 3：縮放檢視氣象區塊
地圖上雙指縮小 → 氣泡逐漸聚合動畫 → 形成氣象區塊
→ 點擊區塊 → 展開區域情緒摘要卡片

## 4.3 頁面線框圖清單
| 頁面 | 優先級 | 狀態 |
|------|--------|------|
| 地圖主頁 | P0 | 待設計 |
| 氣泡詳情 Bottom Sheet | P0 | 待設計 |
| 發文頁 | P0 | 待設計 |
| 區域摘要卡片 | P0 | 待設計 |
| 個人心情歷程 | P1 | 待設計 |
| 設定頁 | P1 | 待設計 |
```

---

## 05 — 系統技術架構

```markdown
# 05 系統技術架構

## 5.1 架構總覽圖

Client (React Native / Flutter)
  ↕ HTTPS + WebSocket
API Gateway (Kong / AWS API Gateway)
  ↕
├── Auth Service        — 身份驗證 (匿名 token)
├── Mood Service        — 心情文 CRUD
├── Geo Service         — 地理空間查詢與聚合
├── Reaction Service    — 回應處理
├── Notification Service — 推播通知
├── Moderation Service  — 內容審核
└── Analytics Service   — 數據收集

  ↕
├── PostgreSQL + PostGIS — 主資料庫
├── Redis               — 快取 + 聚合結果 + 排行
├── Kafka / RabbitMQ    — 事件匯流排
├── S3 / R2             — 靜態資源
└── ClickHouse          — 分析型資料倉儲

## 5.2 技術選型與理由

### 後端框架
| 選項 | 優勢 | 劣勢 | 結論 |
|------|------|------|------|
| Node.js (Fastify) | 生態豐富、WebSocket 原生 | CPU 密集運算弱 | ✅ 主要服務 |
| Go | 高效能、並發強 | 開發速度較慢 | ✅ Geo Service |
| Python | ML/NLP 生態 | 效能瓶頸 | ✅ Moderation |

### 前端框架
| 選項 | 結論 |
|------|------|
| React Native + Mapbox | ✅ 採用 |

### 資料庫
| 用途 | 選型 | 理由 |
|------|------|------|
| 主資料 | PostgreSQL + PostGIS | 地理空間查詢成熟 |
| 快取 | Redis (Cluster) | 聚合結果快取、即時排行 |
| 事件 | Kafka | 解耦服務、事件溯源 |
| 分析 | ClickHouse | 大量時序+地理分析查詢 |

## 5.3 服務通訊模式
- 同步：REST API (服務間 gRPC)
- 非同步：Kafka 事件 (mood.created, reaction.added, etc.)
- 即時：WebSocket (新附近心情推送)

## 5.4 基礎設施
- 雲端：AWS / GCP
- 容器化：Docker + Kubernetes
- CI/CD：GitHub Actions → ArgoCD
- 監控：Prometheus + Grafana + Sentry

## 5.5 擴展性設計
- Geo Service 水平擴展，按地理分區 sharding
- Redis 聚合快取按 H3 resolution 分層
- 讀寫分離：寫入走主庫，地圖瀏覽走讀取副本
```

---

## 06 — 資料庫設計

```markdown
# 06 資料庫設計

## 6.1 ER 關係圖
<!-- 用 Mermaid 或文字描述 -->

## 6.2 核心資料表

### users
| 欄位 | 型別 | 說明 |
|------|------|------|
| id | UUID | PK |
| anonymous_alias | VARCHAR(30) | 自動生成匿名暱稱 |
| device_fingerprint | VARCHAR(64) | 裝置識別 (匿名註冊) |
| subscription_tier | ENUM | free / premium |
| created_at | TIMESTAMPTZ | |
| last_active_at | TIMESTAMPTZ | |

### moods
| 欄位 | 型別 | 說明 |
|------|------|------|
| id | UUID | PK |
| user_id | UUID | FK → users |
| content | VARCHAR(150) | 心情文字 |
| mood_tag | VARCHAR(20) | 心情標籤 (見 appendix/B) |
| valence | FLOAT | 情緒愉悅度 (-1 ~ 1) |
| arousal | FLOAT | 情緒激動度 (-1 ~ 1) |
| location | GEOGRAPHY(Point, 4326) | 精確座標 |
| location_fuzzy | GEOGRAPHY(Point, 4326) | 模糊座標 (街區中心) |
| precision_level | ENUM | exact / neighborhood |
| h3_index_res7 | VARCHAR(15) | H3 index (resolution 7) |
| h3_index_res5 | VARCHAR(15) | H3 index (resolution 5) |
| h3_index_res3 | VARCHAR(15) | H3 index (resolution 3) |
| is_active | BOOLEAN | 是否在有效展示期 |
| expires_at | TIMESTAMPTZ | 過期時間 (預設 +24h) |
| created_at | TIMESTAMPTZ | |

### reactions
| 欄位 | 型別 | 說明 |
|------|------|------|
| id | UUID | PK |
| mood_id | UUID | FK → moods |
| user_id | UUID | FK → users |
| reaction_type | VARCHAR(20) | hug / cheer / feel_you / emoji_❤️ ... |
| created_at | TIMESTAMPTZ | |
| UNIQUE(mood_id, user_id) | | 每人每則限一次 |

### mood_aggregations (快取/預計算表)
| 欄位 | 型別 | 說明 |
|------|------|------|
| id | SERIAL | PK |
| h3_index | VARCHAR(15) | H3 網格索引 |
| h3_resolution | INT | 3 / 5 / 7 |
| dominant_mood | VARCHAR(20) | 主導情緒 |
| avg_valence | FLOAT | 平均愉悅度 |
| avg_arousal | FLOAT | 平均激動度 |
| mood_count | INT | 心情文數量 |
| mood_diversity | FLOAT | 情緒多樣性指數 |
| weather_icon | VARCHAR(10) | 對應天氣圖示 |
| computed_at | TIMESTAMPTZ | 計算時間 |
| period_start | TIMESTAMPTZ | 統計區間起 |
| period_end | TIMESTAMPTZ | 統計區間迄 |

## 6.3 索引策略
- moods: GIST index on location, B-tree on h3_index_*, created_at
- reactions: B-tree on mood_id, user_id
- mood_aggregations: B-tree on (h3_index, h3_resolution, computed_at)

## 6.4 資料生命週期
- 活躍層 (0–24h)：主庫即時查詢
- 溫資料 (24–72h)：仍在主庫但降低展示權重
- 冷資料 (>72h)：歸檔至 ClickHouse，主庫軟刪除
- 永久刪除：用戶主動刪除後 30 天硬刪
```

---

## 07 — API 介面設計

```markdown
# 07 API 介面設計

## 7.1 API 總覽
- Base URL: `https://api.moodmap.app/v1`
- 認證方式: Bearer Token (匿名 JWT)
- 回應格式: JSON
- 速率限制: 60 req/min (free), 300 req/min (premium)

## 7.2 端點清單

### 認證
| Method | Path | 描述 |
|--------|------|------|
| POST | /auth/anonymous | 匿名註冊取得 token |
| POST | /auth/refresh | 重新整理 token |

### 心情文
| Method | Path | 描述 |
|--------|------|------|
| POST | /moods | 發出心情文 |
| GET | /moods/nearby | 取得附近心情文 |
| GET | /moods/:id | 取得單則心情文詳情 |
| DELETE | /moods/:id | 刪除自己的心情文 |

### 回應
| Method | Path | 描述 |
|--------|------|------|
| POST | /moods/:id/reactions | 對心情文回應 |
| GET | /moods/:id/reactions | 取得回應列表 |

### 聚合
| Method | Path | 描述 |
|--------|------|------|
| GET | /aggregations | 取得區域心情氣象 |

### 個人
| Method | Path | 描述 |
|--------|------|------|
| GET | /me/moods | 我的心情歷程 |
| GET | /me/stats | 我的情緒統計 |
| PUT | /me/settings | 更新設定 |

## 7.3 核心端點詳細規格

### POST /moods
Request:
{
  "content": "加班到現在，但完成了一個大專案",
  "mood_tag": "accomplished",
  "latitude": 25.0330,
  "longitude": 121.5654,
  "precision_level": "neighborhood"
}

Response (201):
{
  "id": "uuid",
  "anonymous_alias": "深夜的貓頭鷹",
  "content": "加班到現在，但完成了一個大專案",
  "mood_tag": "accomplished",
  "weather_emoji": "⛅",
  "location_display": "台北市信義區",
  "created_at": "2026-02-17T23:30:00Z",
  "expires_at": "2026-02-18T23:30:00Z"
}

### GET /moods/nearby
Query Params:
- lat (required): 緯度
- lng (required): 經度
- radius: 搜尋半徑 (m)，預設 2000，最大 10000
- zoom: 地圖縮放層級
- mood_tag: 篩選特定心情
- limit: 預設 50，最大 200

### GET /aggregations
Query Params:
- bounds: 地圖可視範圍 (sw_lat,sw_lng,ne_lat,ne_lng)
- resolution: H3 resolution (3/5/7，根據 zoom 自動決定)
- period: 時間範圍 (1h/6h/24h)

Response (200):
{
  "aggregations": [
    {
      "h3_index": "871f1a559ffffff",
      "center_lat": 25.033,
      "center_lng": 121.565,
      "dominant_mood": "tired",
      "weather_icon": "🌧",
      "avg_valence": -0.3,
      "avg_arousal": -0.5,
      "mood_count": 142,
      "mood_distribution": {
        "tired": 0.35,
        "anxious": 0.25,
        "peaceful": 0.20,
        "happy": 0.15,
        "angry": 0.05
      }
    }
  ]
}

## 7.4 WebSocket 事件
Channel: ws://api.moodmap.app/v1/ws

### 訂閱
{ "action": "subscribe", "h3_cells": ["871f1a559ffffff", ...] }

### 伺服器推送事件
- mood.new      — 附近新心情文
- mood.expired  — 心情文過期
- reaction.new  — 你的心情文收到回應
- aggregation.updated — 區域聚合數據更新

## 7.5 錯誤碼
| Code | 描述 |
|------|------|
| 4001 | 心情文字包含敏感內容 |
| 4002 | 發文頻率超過限制 |
| 4003 | 定位服務異常 |
| 4004 | 已對此心情文回應過 |
```

---

## 08 — 地圖與視覺化系統

```markdown
# 08 地圖與視覺化系統

## 8.1 地圖技術選型
- 底圖：Mapbox GL JS (React Native 用 @rnmapbox/maps)
- 自訂地圖風格：暗色調底圖，降低視覺干擾突出心情氣泡

## 8.2 視覺分層架構
| 圖層 (由下至上) | 描述 | 顯示層級 |
|----------------|------|----------|
| Base Map | 自訂暗色底圖 | 全層級 |
| Aggregation Heatmap | 情緒熱力底色 | Zoom ≤ 14 |
| Weather Zones | H3 氣象區塊多邊形 | Zoom ≤ 11 |
| Cluster Bubbles | 聚合氣團 | Zoom 12–14 |
| Individual Bubbles | 個別心情氣泡 | Zoom ≥ 15 |
| User Location | 用戶自身定位標記 | 全層級 |

## 8.3 心情氣泡設計
### 單一氣泡
- 尺寸：依回應數動態調整 (基礎 40px，每 10 個回應 +4px)
- 顏色：對應心情標籤色彩 (見 appendix/C)
- 動畫：呼吸式脈動 (CSS pulse animation)
- 點擊展開：Bottom Sheet 滑出心情詳情

### 聚合氣團 (Zoom 12–14)
- 外觀：較大的半透明圓形，內含主導情緒圖示
- 數字標記：顯示聚合數量
- 顏色：加權混合色

### 氣象區塊 (Zoom ≤ 11)
- H3 六邊形多邊形填色
- 天氣圖示居中顯示
- 邊界模糊化處理 (避免生硬邊界)
- 動態效果：晴天微光、雨天水滴粒子、風暴閃爍

## 8.4 色彩情緒映射表
| 心情標籤 | 顏色 | Hex | 天氣隱喻 |
|----------|------|-----|----------|
| happy | 暖黃 | #FFD93D | ☀️ 晴天 |
| excited | 橙紅 | #FF6B35 | 🔥 熱浪 |
| peaceful | 淺藍 | #6BC5F8 | 🌤 微風 |
| tired | 灰藍 | #8B9DAF | ⛅ 多雲 |
| sad | 深藍 | #4A6FA5 | 🌧 雨天 |
| anxious | 紫灰 | #9B8EC1 | 🌫 霧 |
| angry | 深紅 | #D64045 | ⛈ 風暴 |
| hopeful | 彩虹漸層 | — | 🌈 彩虹 |

## 8.5 縮放過渡動畫
- Zoom 15 → 14：個別氣泡漸漸靠攏
- Zoom 14 → 12：氣泡融合成氣團 (merge animation)
- Zoom 12 → 11：氣團擴散填滿 H3 六邊形
- 反向縮放：區塊分裂回氣團再分裂回個別氣泡
```

---

## 09 — 即時通訊與推播系統

```markdown
# 09 即時通訊與推播系統

## 9.1 即時連線架構
- WebSocket 連線管理 (Socket.IO / ws)
- 連線池：依用戶當前 H3 cell 分配 channel
- 用戶移動時自動重新訂閱相鄰 cells

## 9.2 事件流設計
### 發文事件流
用戶發文 → Mood Service → Kafka [mood.created]
  → Notification Service → 找出訂閱相鄰 cells 的在線用戶 → WebSocket 推送
  → Aggregation Worker → 更新快取 → WebSocket 推送區塊更新

### 回應事件流
用戶回應 → Reaction Service → Kafka [reaction.added]
  → Notification Service → 推送給心情文作者
  → Aggregation Worker → 可能微調區塊氛圍

## 9.3 推播通知策略
| 事件 | 通知方式 | 頻率控制 |
|------|----------|----------|
| 收到回應 | Push + In-app | 合併：5 分鐘內多個回應合成一則 |
| 附近新心情文 | In-app only | 每 10 分鐘最多 1 則 |
| 區域氣象變化 | Push (opt-in) | 每 6 小時最多 1 則 |
| 心情文即將過期 | In-app | 過期前 1 小時 |

## 9.4 離線處理
- 離線期間的推播暫存於 FCM/APNs
- 重新上線時同步最新附近資料 (差量更新)
```

---

## 10 — 心情聚合引擎

```markdown
# 10 心情聚合引擎

## 10.1 核心概念
將大量個別心情文透過空間聚類和情緒統計，
生成區域性的「心情氣象」資料供地圖視覺化使用。

## 10.2 空間索引系統：H3
- 採用 Uber H3 六邊形網格系統
- 三層 resolution 對應地圖縮放：
  | H3 Res | 六邊形面積 | 對應 Zoom | 用途 |
  |--------|-----------|-----------|------|
  | 7 | ~5.16 km² | 12–14 | 街區級氣團 |
  | 5 | ~252 km² | 9–11 | 區域級氣象 |
  | 3 | ~12,393 km² | 6–8 | 城市級概覽 |

## 10.3 聚合計算流程

### Step 1: 資料收集
SELECT mood_tag, valence, arousal, created_at
FROM moods
WHERE h3_index_res7 = :cell
  AND is_active = true
  AND created_at > NOW() - INTERVAL '24 hours';

### Step 2: 時間衰減加權
weight = exp(-λ * age_in_hours)
-- λ = 0.1 → 24小時後權重約 0.09

### Step 3: 情緒統計
- 加權平均 valence 和 arousal
- 各 mood_tag 的加權佔比分佈
- 主導情緒 = 佔比最高的 mood_tag
- 多樣性指數 = Shannon Entropy

### Step 4: 天氣映射
根據 (avg_valence, avg_arousal) 二維座標映射到天氣圖示：
- (+V, +A) → ☀️ 晴天 / 🔥 熱浪
- (+V, -A) → 🌤 微風 / 🌈 彩虹
- (-V, +A) → ⛈ 風暴 / 🌪 颶風
- (-V, -A) → 🌧 雨天 / 🌫 霧

### Step 5: 寫入快取
- Redis: SET agg:{h3_index}:{resolution} {JSON} EX 300
- PostgreSQL: UPSERT mood_aggregations

## 10.4 計算排程
- 熱區 (mood_count > 50/hr)：每 2 分鐘更新
- 一般區域：每 5 分鐘更新
- 冷區 (mood_count < 5/hr)：每 15 分鐘更新
- 排程器：基於 Kafka 事件流的動態頻率調整

## 10.5 跨層級聚合
- Resolution 7 的結果向上聚合至 Resolution 5
- Resolution 5 再向上聚合至 Resolution 3
- 上層聚合 = 下層子格的加權平均 (權重 = mood_count)

## 10.6 邊界處理
- H3 的 k-ring 鄰近函數自動處理邊界模糊
- 相鄰格子的情緒用高斯模糊做平滑過渡
```

---

## 11 — 內容審核與安全機制

```markdown
# 11 內容審核與安全機制

> **本章節為 P0 最高優先級**：所有安全機制必須在 V0.1 Alpha 即完整上線，
> 不得因功能排期而延後。任何功能上線前必須通過安全影響評估。

## 11.1 安全架構總覽 — 「Zero Tolerance + Warm Intervention」雙軌策略

本平台採用雙軌並行的安全策略：
- **Zero Tolerance（零容忍軌）**：對明確有害內容（具體自殺/自傷手段描述、仇恨煽動、色情、暴力威脅）採取硬性攔截，絕不允許公開展示
- **Warm Intervention（溫暖介入軌）**：對可能處於心理危機的用戶，不以懲罰性方式處理，而是主動提供關懷資源與專業支援

### 審核流程總覽

發文 → 即時四層自動審核 (≤200ms)
  → ✅ 安全通過 → 正常發佈
  → 🟡 黃色警戒 (低風險負面情緒) → 正常發佈 + 溫和推送正向資源
  → 🟠 橙色警戒 (疑似高風險) → 發佈但加上關懷提示橫幅 + 排入優先人工佇列
  → 🔴 紅色警戒 (明確高風險) → 僅作者可見（不公開） + 即時推送關懷資源 + 人工團隊緊急介入
  → ⛔ 硬性攔截 (有害內容) → 不發佈 + 告知用戶 + 提供替代表達引導

## 11.2 四層自動審核系統

### Layer 1: 多語言關鍵字與模式過濾 (≤10ms)
- **黑名單關鍵字庫**：仇恨、暴力、色情、自殺/自傷具體手段
- **多語言變體偵測**：
  - 繁簡中文互轉
  - 注音/拼音繞過偵測 (如「ㄙˇ」=「死」)
  - 諧音字/同音字替換 (如「4」=「死」)
  - Unicode 視覺相似字偵測 (如全形/半形混用、特殊字元替換)
  - 火星文 / 縮寫變體 (如「g0 d13」= 特定有害詞彙)
- **正則表達式模式匹配**：偵測特定結構化有害模式
- **白名單例外**：允許包含心理健康教育、新聞引述等合理語境
- **關鍵字庫更新週期**：每週自動更新 + 即時人工補充

### Layer 2: NLP 語意分析 (≤100ms)
- **自殺/自傷意圖偵測（最高優先級）**：
  - 使用 fine-tuned BERT / LLM API 進行語意理解
  - 區分口語化抱怨（如「我好累想死」≈「我很疲憊」）vs. 真正自傷意圖
  - 輸出多級信心度分數 (0.0 ~ 1.0)
  - 信心度門檻：
    | 信心度範圍 | 判定 | 處理方式 |
    |-----------|------|---------|
    | 0.0 – 0.3 | 安全 | 正常發佈 |
    | 0.3 – 0.6 | 低風險 | 黃色警戒（若連續多則） |
    | 0.6 – 0.85 | 中高風險 | 橙色警戒 |
    | 0.85 – 1.0 | 高風險 | 紅色警戒 |
- **霸凌/攻擊性語言偵測**：
  - 針對特定群體的仇恨言論
  - 對其他用戶的人身攻擊或騷擾
  - 煽動暴力或傷害他人
- **垃圾訊息/廣告偵測**
- **模型維護**：每月使用新標註數據重新訓練，持續提升準確度

### Layer 3: 行為模式分析 (≤50ms)
- **頻率異常**：短時間大量發文 → 限速（每小時 3 則硬上限）
- **位置異常**：同一位置反覆發攻擊性內容 → 該位置暫停發文權限
- **情緒軌跡偵測**：
  - 連續 3 則以上負面情緒標籤 → 觸發黃色警戒
  - 情緒 valence 值在 24 小時內從正常急遽下降 → 觸發橙色警戒
  - 深夜 (00:00–05:00) 高頻負面發文 → 主動推送關懷資源
- **新帳號信任評分**：新帳號前 72 小時降低信任分，提高審核敏感度
- **累犯加重**：曾被攔截/警告的帳號，後續發文自動提高審核嚴格度

### Layer 4: 傳染效應防護 (Werther Effect Prevention)
- **目的**：防止自殺/自傷相關內容在平台上形成「模仿效應」（維特效應）
- **區域情緒汙染偵測**：
  - 若特定 H3 區域在短時間內出現異常集中的自傷相關內容，自動啟動「區域關懷模式」
  - 區域關懷模式下：增加正向內容曝光權重、在該區域地圖上顯示關懷資源卡片
- **內容去敏化處理**：
  - 即使通過審核的負面心情文，也不會在「附近推薦」或「熱門」中被演算法加權推送
  - 瀏覽者連續閱讀 5 則以上負面心情文時，自動插入「休息提醒」卡片 + 正向內容
  - 單一用戶在 1 小時內最多看到的負面心情文數量上限為 15 則
- **模仿型內容辨識**：
  - 偵測與近期高風險內容高度相似的發文（語意相似度 > 0.8）
  - 疑似模仿型內容自動提升審核等級

## 11.3 自殺/自傷三級響應協議（最高優先機制）

> **核心原則**：不懲罰表達者，但必須阻止有害內容公開傳播並保護所有用戶

### 🔴 紅色警戒 — 高風險即時響應
**觸發條件**：NLP 信心度 > 0.85、或文字包含具體自殺/自傷手段描述
**響應流程**：
1. **內容處理**：心情文不公開發佈，僅作者本人可見（不刪除，尊重表達權）
2. **即時關懷推送**（發文後 3 秒內）：
   - 全螢幕關懷卡片：「我們注意到你可能正經歷很大的痛苦。你不是一個人。」
   - **一鍵撥打生命線**：台灣 1925 / 安心專線 1980
   - 各地區在地化心理援助熱線（根據 GPS 定位自動匹配）
   - 文字危機諮詢連結
3. **人工團隊緊急介入**：30 分鐘內必須有受過心理急救（PFA）培訓的審核員回應
4. **72 小時追蹤關懷**：
   - 24h 後推送溫暖關懷訊息
   - 48h 後推送心理健康資源
   - 72h 後推送「我們還在」關懷訊息
   - 若該用戶 72h 內未再登入，標記為「需持續關注」
5. **記錄存檔**：所有紅色警戒事件記入安全日誌，供定期安全審計

### 🟠 橙色警戒 — 中高風險積極關懷
**觸發條件**：NLP 信心度 0.6–0.85、或情緒急遽惡化軌跡
**響應流程**：
1. **內容處理**：正常發佈，但在心情文上方附加「關懷提示橫幅」
   - 橫幅內容：「如果你正經歷困難，這裡有資源可以幫助你 →」+ 專線連結
2. **排入優先人工佇列**：2 小時內由受訓審核員檢視
3. **該心情文的回應區**：優先顯示溫暖罐頭回應，系統自動投放一則溫暖回應
4. **瀏覽者保護**：該心情文不參與附近推薦排序加權
5. **發文者端**：24h 後推送溫暖關懷訊息 + 心理資源連結

### 🟡 黃色警戒 — 低風險溫和關懷
**觸發條件**：連續 3 則以上負面情緒（valence < -0.3）、或深夜高頻負面發文
**響應流程**：
1. **內容處理**：正常發佈，不附加任何標記
2. **發文者端溫和推送**（非阻斷式）：
   - 「最近辛苦了，這裡有一些可能對你有幫助的資源 💙」
   - 推送個人化正向內容（例如附近的正面心情文精選）
3. **不觸發人工審核**，但記入用戶情緒軌跡供系統持續追蹤
4. **若 7 天內觸發 3 次以上黃色警戒**：自動升級為橙色警戒

## 11.4 有害內容傳播阻斷機制

### 硬性攔截規則（不走 NLP 灰色地帶，100% 攔截）
以下內容一經偵測即刻攔截，不予發佈：
- 描述具體自殺/自傷方式、工具、地點的文字
- 鼓勵、美化、浪漫化自殺/自傷行為的文字
- 直接煽動他人自殺或傷害自身的文字
- 仇恨言論（針對種族、性別、性取向、宗教、身心障礙的歧視煽動）
- 暴力威脅（對特定個人或群體的傷害威脅）
- 兒童安全相關有害內容

### 攔截後用戶引導
- 不使用冰冷的「您的內容違反規定」措辭
- 改用溫暖引導語：「我們理解你可能正經歷很大的壓力。為了保護社區中的每一個人，這則內容暫時無法發佈。」
- 同時提供：心理援助資源連結 + 建議用戶以其他方式表達情緒
- 提供「重新編輯」選項，讓用戶修改後再發送

### 瀏覽者保護機制
- 負面情緒氣泡不參與「熱門」或「附近推薦」的排序加權
- 連續閱讀 5 則以上負面心情文（valence < -0.3）時：
  - 自動插入「休息一下」提示卡片
  - 推薦附近正向心情文精選
  - 顯示心理健康小知識或正向語錄
- 單一用戶 1 小時內可見的高負面心情文（valence < -0.5）上限為 15 則
- 地圖上若某區域負面比率 > 60%，視覺上增加暖色調過濾層，緩和整體觀感

## 11.5 心理專業資源整合

### 常駐資源入口
- App 底部導航列或設定頁內建「心理健康資源」常駐入口，永遠可見
- 內容包含：
  - 台灣生命線：1925（24 小時）
  - 安心專線：1980（24 小時）
  - 張老師專線：1980
  - 各縣市社區心理衛生中心列表
  - 線上文字諮詢平台連結
- 國際化版本根據用戶 GPS 定位自動顯示當地對應資源

### 專業機構合作
- 與心理健康 NGO（如台灣自殺防治學會、董氏基金會）建立合作
- 合作內容：
  - 關懷卡片文案由專業人士審核
  - 定期提供平台內心理健康教育內容
  - 危機事件顧問支援
- 大學心輔中心合作：校園版可直接連結校內心輔資源

### 定期心理健康活動
- 每月一次「心理健康主題週」：
  - 正向心情發文引導活動
  - 心理健康小知識推播
  - 與專業機構合辦線上講座
- 世界心理健康日 (10/10)、世界自殺防治日 (9/10) 特別企劃

## 11.6 人工審核團隊與 SLA

### 審核員資格要求
- 必須完成「心理急救」(Psychological First Aid, PFA) 培訓課程
- 必須完成平台安全政策培訓
- 每季接受一次複訓與案例研討
- 審核員自身心理健康支持：定期團體督導、必要時提供心理諮商資源

### 分級響應 SLA
| 警戒等級 | 響應時限 | 處理人員 |
|---------|---------|---------|
| 🔴 紅色 | ≤ 30 分鐘 | 資深安全審核員（PFA 認證） |
| 🟠 橙色 | ≤ 2 小時 | 安全審核員 |
| 一般檢舉 | ≤ 12 小時 | 一般審核員 |
| 申訴處理 | ≤ 24 小時 | 資深審核員 + 主管覆核 |

### 排班與覆蓋
- 24/7 全天候至少 1 名安全審核員值班
- 高峰時段 (18:00–02:00) 增加至 2–3 名
- 重大事件或節日前後增派人力

### 審核後台功能
- 分級佇列 dashboard（紅色置頂、自動排序）
- 一鍵觸發「紅色警戒」完整流程
- 用戶歷史行為快速查閱
- 審核結果：通過 / 隱藏 / 封鎖用戶 / 升級至紅色響應
- 完整申訴機制（用戶可申訴被攔截/隱藏的心情文）

## 11.7 檢舉系統

- 用戶可對任何心情文一鍵檢舉
- 檢舉分類：
  - 🔴 自殺/自傷相關 → 自動觸發橙色警戒流程
  - 仇恨言論 / 暴力威脅
  - 騷擾 / 霸凌
  - 垃圾訊息 / 廣告
  - 不當內容 / 其他
- 檢舉為「自殺/自傷相關」時，額外提示檢舉者：「感謝你的關心，我們會盡快處理。如果你自己也需要支持，這裡有資源可以幫助你。」
- 累計 3 則被確認有效檢舉 → 帳號暫停 24 小時
- 累計 5 則 → 帳號暫停 7 天 + 需人工審核才可恢復
- 嚴重違規（煽動自殺/仇恨/暴力）→ 即時永久封鎖

## 11.8 平台情緒安全儀表板

### 即時監控指標
| 指標 | 正常範圍 | 告警閾值 | 緊急閾值 |
|------|---------|---------|---------|
| 全平台負面情緒比率 | < 30% | > 50% | > 70% |
| 紅色警戒事件/日 | < 5 | > 10 | > 20 |
| 橙色警戒事件/日 | < 30 | > 60 | > 100 |
| 特定區域負面集中度 | < 40% | > 60% | > 80% |
| 人工審核佇列積壓數 | < 20 | > 50 | > 100 |
| 平均審核響應時間 | < SLA | SLA 的 80% | 超出 SLA |

### 自動應急機制
- 特定區域負面比率 > 70% → 自動觸發「區域關懷模式」：
  - 該區域地圖上顯示關懷資源浮動卡片
  - 增加正向內容曝光權重 (3x)
  - 通知審核團隊加強監控
- 全平台負面比率 > 70% → 觸發「全平台關懷模式」：
  - 首頁顯示關懷橫幅
  - 所有推播加入心理健康資源連結
  - 高層管理通知 + 緊急會議

### 安全報告
- **週報**：關鍵安全指標趨勢、攔截統計、警戒事件摘要
- **月報**：深度分析 + 安全機制效能評估 + 改善建議
- **季度報**：邀請外部心理健康專家審閱，提出改善方向
- 所有報告存檔備查，作為合規與審計依據

## 11.9 安全機制持續改善

### 機制審核週期
- 關鍵字庫：每週更新
- NLP 模型：每月重新訓練/微調
- 安全策略：每季全面審查
- 外部專家審計：每半年一次

### 事件復盤機制
- 所有紅色警戒事件必須在 7 天內完成復盤報告
- 復盤內容：偵測是否及時、響應是否適當、有無改善空間
- 復盤結論回饋至審核規則與模型訓練

### 上線前安全測試
- 每個版本上線前必須通過「安全測試套件」：
  - 有害內容攔截率測試 (目標 > 99%)
  - 誤攔率測試 (目標 < 5%)
  - 關懷資源推送正確性測試
  - 響應時間壓力測試
  - 各語言變體繞過測試
```

---

## 12 — 隱私權與資安策略

```markdown
# 12 隱私權與資安策略

## 12.1 隱私設計原則 (Privacy by Design)
1. 最小資料收集 — 不要求真實姓名、信箱、電話
2. 定位模糊化 — 預設街區級，用戶可選精確
3. 資料時效性 — 自動過期，不永久保留位置軌跡
4. 聚合匿名化 — 對外展示一律為聚合統計

## 12.2 匿名身份系統
- 註冊方式：裝置指紋 + 隨機 UUID
- 不綁定手機/信箱 (免費層)
- 匿名暱稱自動生成 (「形容詞+名詞」組合，如「深夜的貓頭鷹」)
- 每則心情文可選擇是否沿用暱稱或生成新暱稱

## 12.3 定位隱私
### 模糊化演算法
- 「街區級」模式：座標 snap 到最近的 H3 res-9 格子中心點
- 增加隨機偏移 (±100m 高斯雜訊)
- 儲存時同時存精確座標 (加密) 和模糊座標
- 對外 API 一律回傳模糊座標

### 位置資料加密
- 精確座標使用 AES-256 加密後儲存
- 解密金鑰由用戶端持有
- 伺服器端聚合計算使用 H3 index (不需解密精確座標)

## 12.4 資安措施
- 傳輸加密：TLS 1.3
- 靜態加密：AES-256 (資料庫層)
- API 認證：JWT + 短效 token (15min) + refresh token
- DDoS 防護：Cloudflare / AWS Shield
- 滲透測試：上線前 + 每季一次
- SOC 2 Type II 認證 (目標 V2 時程)

## 12.5 合規
- GDPR 合規 (歐洲用戶)
- 個人資料保護法 (台灣)
- CCPA (美國加州用戶)
- 用戶資料匯出 / 刪除 API (Right to be forgotten)

## 12.6 隱私權政策大綱
<!-- 需請法律顧問正式撰寫 -->
```

---

## 13 — DevOps 與部署策略

```markdown
# 13 DevOps 與部署策略

## 13.1 環境規劃
| 環境 | 用途 | 基礎設施 |
|------|------|----------|
| local | 開發 | Docker Compose |
| dev | 整合測試 | K8s (小規模) |
| staging | 預發佈驗證 | K8s (模擬 prod) |
| production | 正式環境 | K8s (多節點) |

## 13.2 CI/CD Pipeline
GitHub Push → GitHub Actions
  → Lint + Unit Test
  → Build Docker Image
  → Push to Container Registry
  → (dev) Auto deploy
  → (staging) Auto deploy + Integration Test + E2E Test
  → (prod) Manual approval → ArgoCD rolling deploy

## 13.3 Kubernetes 架構
- Namespace 按服務分隔
- HPA (Horizontal Pod Autoscaler) 自動擴展
- Geo Service 配置較高 CPU/Memory limit
- Redis Cluster 使用 StatefulSet

## 13.4 監控與告警
| 工具 | 用途 |
|------|------|
| Prometheus + Grafana | 基礎設施 & 應用指標 |
| Sentry | 錯誤追蹤 |
| Jaeger | 分散式追蹤 |
| PagerDuty | 告警升級 |

### 關鍵告警規則
- API 回應時間 P99 > 2s
- 錯誤率 > 1%
- WebSocket 連線數異常飆升
- 聚合引擎延遲 > 10 分鐘
- 資料庫連線池使用率 > 80%

## 13.5 災難復原
- 資料庫：每日備份 + WAL 串流複寫 (RPO < 1min)
- 跨區域 standby (RTO < 30min)
- Runbook 文件化所有故障場景
```

---

## 14 — 數據分析與關鍵指標

```markdown
# 14 數據分析與關鍵指標

## 14.1 指標框架 (AARRR)

### Acquisition (獲取)
- 每日新註冊用戶數
- 各渠道來源 (organic / referral / paid)
- App Store 轉化率

### Activation (啟動)
- 首日發文率 (註冊後 24h 內發第一則)
- 首日互動率 (24h 內回應他人)
- 「啊哈時刻」：首次收到回應

### Retention (留存)
- D1 / D7 / D30 留存率
- 週活躍用戶 (WAU)
- 每用戶每週平均發文數

### Revenue (收入)
- 付費轉化率
- ARPU / ARPPU
- 訂閱續約率
- LTV / CAC 比率

### Referral (推薦)
- 自然邀請率
- K-factor (病毒係數)

## 14.2 產品健康指標
| 指標 | 目標值 | 告警閾值 |
|------|--------|----------|
| DAU/MAU | > 0.3 | < 0.15 |
| 每則心情文平均回應數 | > 3 | < 1 |
| 心情文 24h 曝光率 | > 60% | < 30% |
| 區域覆蓋密度 (目標城市) | > 50 則/km²/日 | < 10 |

## 14.3 數據管道架構
App → Event SDK → Kafka → ClickHouse → Metabase / Superset
                       → Spark (離線分析)
                       → ML Pipeline (情緒趨勢預測)

## 14.4 A/B Testing 框架
- 功能旗標 (Feature Flags)：LaunchDarkly / 自建
- 實驗分群：按用戶 ID hash 分桶
- 統計顯著性要求：p < 0.05, 最小樣本 1000/組
```

---

## 15 — 商業模式與變現策略

```markdown
# 15 商業模式與變現策略

## 15.1 Freemium 訂閱模型

### Free 方案
- 每日發文上限：5 則
- 瀏覽附近心情 (半徑 2km)
- 基礎罐頭回應 (5 種)
- 匿名短回覆 (每日 3 則)
- 24 小時心情歷程
- 基礎心情天氣分享卡片（含浮水印）
- 情緒日記連續紀錄

### Premium 方案 (月費 NT$90 / 年費 NT$790)
- 無限發文
- 全城市範圍瀏覽
- 完整罐頭回應 + 自訂回應 + 無限匿名短回覆
- 30 天心情歷程
- 個人情緒趨勢報告
- **專屬心情氣泡外觀庫**（見 15.2 虛擬道具）
- **精美分享卡片**（無浮水印 + 專屬 Premium 模板）
- **「送溫暖」虛擬禮物**（每月贈送 5 次額度，見 15.3）
- 無廣告

### Pro 方案 (月費 NT$190) — V2
- 含 Premium 全部功能
- 365 天心情歷程
- 城市心情報告存取
- 進階情緒趨勢分析（含週/月/季比較）
- 「送溫暖」無限額度
- API 存取 (開發者)

## 15.2 虛擬道具系統 (V1.5+)

> 低單價、高頻次的微交易，降低首次付費門檻

### 氣泡外觀裝飾
- **氣泡皮膚**：不同形狀、質感、邊框（如水晶氣泡、霓虹氣泡、櫻花氣泡）
- 定價：NT$15–30 / 個，或包含在 Premium 訂閱中
- **限定版皮膚**：節日限定（聖誕雪花、新年煙火）、城市限定（台北 101、東京鐵塔）
- 限定版營造稀缺感，可提升付費意願

### 氣泡特效
- 發文動畫效果：飄落櫻花、閃爍星星、水波紋擴散
- 定價：NT$10–20 / 次使用，或 NT$50 / 永久解鎖

### 個人化匿名暱稱裝飾
- 暱稱前綴圖示 / 特殊顏色
- 定價：NT$20–40 / 個

## 15.3 「送溫暖」虛擬禮物機制 (V1.5+)

> 將付費行為與善意連結，提升付費的情感價值

### 機制設計
- 用戶可對他人心情文「送溫暖」：
  - ☕ 一杯虛擬咖啡 (NT$15)
  - 🧸 一個虛擬擁抱 (NT$10)
  - 🌻 一朵向日葵 (NT$10)
  - 🎁 驚喜禮盒 (NT$30，隨機特效)
- 收到禮物的用戶會看到動畫效果 + 溫暖提示語
- 送禮者匿名（可選擇是否顯示暱稱）
- **收到的禮物不可兌換現金**（避免衍生問題）

### 商業邏輯
- 付費動機 = 「我想讓這個陌生人感覺好一點」 → 情感價值驅動，非功能驅動
- 平台抽成 0%（初期），禮物收入 100% 為平台營收
- 受贈者的正向體驗強化留存飛輪

## 15.4 B2B 數據服務 (V3+)
- 匿名聚合城市情緒報告
- 客群：城市規劃、商業地產、學術研究、公共衛生
- 定價：依資料粒度和範圍客製
- **安全規則**：B2B 數據僅提供聚合統計，絕不包含個人層級資料

## 15.5 品牌合作 (V2+)
- 品牌贊助罐頭回應 (如 Starbucks：「請你一杯咖啡 ☕」)
- 品牌贊助「送溫暖」禮物（如品牌專屬虛擬禮物造型）
- 品牌情緒打卡站 (地圖上特殊 POI)
- CPM / CPC 計價
- **品牌合作安全規則**：品牌相關內容不得出現在關懷資源卡片或安全相關介面中

## 15.6 財務預測 (簡化)
| 指標 | Year 1 | Year 2 | Year 3 |
|------|--------|--------|--------|
| MAU | 50K | 300K | 1M |
| 訂閱付費率 | 3% | 5% | 7% |
| 虛擬道具/禮物付費率 | — | 8% | 12% |
| 訂閱 ARPU (monthly) | NT$90 | NT$110 | NT$130 |
| 道具 ARPU (monthly) | — | NT$25 | NT$35 |
| 訂閱 MRR | NT$135K | NT$1.65M | NT$9.1M |
| 道具+禮物 MRR | — | NT$600K | NT$4.2M |
| 品牌合作收入/月 | — | NT$200K | NT$1.5M |
| 總 MRR | NT$135K | NT$2.45M | NT$14.8M |
```

---

## 16 — 上市策略與成長計畫

```markdown
# 16 上市策略與成長計畫

## 16.1 冷啟動策略

### Phase 0：封測 (Beta)
- 目標：1 個城市 (台北)、500 位種子用戶
- 來源：PTT、Dcard、大學心理健康社團
- 策略：邀請制，每位用戶 3 個邀請碼
- 預埋內容：團隊每日在各區發心情文維持地圖密度
- **環境情緒層（解決「空地圖」問題）**：
  - 根據即時天氣、時間帶 (早晨/午後/深夜)、地點特性 (商業區/住宅區/校園) 由 AI 生成背景氛圍氣泡
  - 所有系統生成內容明確標記為「環境氛圍」（半透明淺色氣泡），與真實用戶心情文視覺區隔
  - 確保新用戶打開 App 時地圖不會「空蕩蕩」，有基礎的視覺豐富度
  - 隨著真實用戶內容增加，環境氛圍氣泡逐步淡出
- **累積數據模式**：初期展示「過去 7 天」累積數據，而非僅即時數據，確保地圖密度
- **臨界密度定義**：每 km² 至少 15 則真實心情文/日 → 該區域「解鎖」即時模式（停止顯示環境氛圍氣泡）

### Phase 1：單城市驗證
- 目標：台北 DAU 5,000
- 策略：
  - KOL 合作 (心理健康 YouTuber / IG 創作者)
  - 校園大使計畫
  - 「台北今天的心情」每日社群內容（配合 F-015 分享卡片機制）
  - 限時活動：跨年夜 / 情人節 / 大學期末考 情緒地圖
  - **事件驅動引爆**：針對社會熱點事件（颱風天、選舉日、跨年倒數）推出即時情緒地圖，主動在社群媒體發佈截圖製造話題
  - **校園挑戰賽**：「你的學校今天是什麼天氣？」校際情緒比拼（正向氛圍引導）

### Phase 2：多城市擴展
- 目標城市：高雄、台中、新北
- 每個城市需達到臨界密度 (>15 則/km²/日) 才正式開放即時模式
- 開放前先啟用「環境情緒層」+ 預埋內容維持基礎體驗
- 當地社群經營 + 在地 KOL 合作
- 城市 vs 城市的「情緒天氣對決」話題行銷

### Phase 3：國際化
- 目標市場：日本 (東京)、香港、東南亞
- 多語言支援
- 在地化心情標籤與罐頭回應
- **在地化安全資源**：各國/地區心理援助熱線、專業機構自動配置

## 16.2 成長飛輪 — 雙迴路互鎖設計

### 迴路 A：留存飛輪（產品內循環）
用戶發文 → 收到回應（罐頭/短回覆）→ 感受到被理解的溫暖
→ 情緒共鳴推薦（「附近有人和你一樣」）→ 歸屬感增強
→ 養成每日記錄習慣（情緒日記連續紀錄）→ 持續發文

### 迴路 B：傳播飛輪（產品外擴散）
用戶查看個人/城市心情天氣 → 自動生成精美分享卡片
→ 分享到 IG Story / LINE / 社群 → 朋友看到「台北信義區現在是🌧」
→ 好奇下載 App → 打開地圖看到豐富的心情氣泡 → 自己也想發文

### 飛輪加速器（事件驅動）
社會熱點事件 / 節日 / 天氣極端 → MoodMap 官方即時發佈城市情緒地圖截圖
→ 社群媒體病毒式傳播（「原來跨年夜台北最多人感覺 hopeful！」）
→ 大量新用戶湧入 → 留存飛輪接住 → 轉為長期用戶

### 關鍵設計：迴路 B 的分享卡片必須通過安全規則
- 分享卡片**不包含**任何具體負面/高風險心情文原文
- 卡片僅展示聚合後的天氣隱喻 + 正向統計（如「今天 62% 的人感覺不錯」）
- 確保外部傳播內容始終正向、安全

## 16.3 內容策略
- **每日城市心情天氣**：每天固定時間在 IG / Twitter / Facebook 發佈城市心情天氣卡片
- **「你所在的城市今天是 ☀️」推播**：帶有分享按鈕，一鍵轉發至社群
- **每週城市情緒報告**：長圖表式摘要，含有趣洞察（「週五下午信義區最多人感到 excited！」）
- **節日特別版心情地圖**：年度回顧、聖誕節、跨年、農曆新年特別設計
- **熱點事件即時地圖**：颱風天、選舉日、大型活動的即時情緒地圖（純聚合數據，不含個人心情文）
- **心理健康教育內容**：每月配合「心理健康主題週」產出教育性內容

## 16.4 合作夥伴
- **心理健康機構**：台灣自殺防治學會、董氏基金會（提供專業資源 + 審核關懷內容）
- **大學心輔中心**：校園情緒健康監測 + 校園版特別功能
- **地方政府**：城市幸福感指數合作（匿名聚合數據）
- **社群媒體 KOL**：心理健康領域創作者長期合作
- **企業 CSR**：品牌贊助心理健康活動（「OO品牌關心你的心情」）
```

---

## 17 — 產品路線圖

```markdown
# 17 產品路線圖

> **安全里程碑規則**：每個版本上線前必須通過安全測試套件（有害內容攔截率 > 99%、誤攔率 < 5%、關懷資源推送正確性 100%）。未通過安全測試不得上線。

## V0.1 — Alpha 內測 (Month 1–3)
### 核心功能
- [x] 匿名註冊
- [x] GPS 定位發文
- [x] 地圖顯示個別心情氣泡
- [x] 基礎罐頭回應
### ⚠️ 安全防護（P0 — Alpha 即完整上線）
- [ ] 四層自動審核引擎（關鍵字過濾 + NLP 語意分析 + 行為模式 + 傳染效應防護）
- [ ] 三級自殺/自傷響應協議（紅/橙/黃警戒完整流程）
- [ ] 硬性攔截規則（具體手段描述、煽動內容零容忍）
- [ ] 關懷資源中心（F-014：一鍵撥打生命線 1925、安心專線 1980、在地化資源）
- [ ] 關懷資源卡片推送系統（紅色/橙色警戒觸發時即時推送）
- [ ] 瀏覽者保護機制（負面內容曝光限制 + 休息提醒）
- [ ] 檢舉系統（含「自殺/自傷相關」分類快速通道）
- [ ] 人工審核後台 + 紅色警戒 30 分鐘 SLA 流程
- [ ] 安全測試套件 v1（上線前必須全部通過）

## V0.5 — Beta 公測 (Month 4–5)
- [ ] 心情氣象區塊 (聚合引擎 V1)
- [ ] 縮放層級過渡動畫
- [ ] WebSocket 即時更新
- [ ] 推播通知
- [ ] 平台情緒安全儀表板 v1（即時監控 + 區域關懷模式自動觸發）
- [ ] 環境情緒層（AI 生成背景氛圍，解決冷啟動空地圖問題）
- [ ] 🔒 安全審計 #1：外部心理健康專家審閱安全機制

## V1.0 — 正式上線 (Month 6–7)
- [ ] 完整心情標籤系統
- [ ] 定位模糊化選項
- [ ] 個人心情歷程
- [ ] 心情篩選器
- [ ] Freemium 付費系統
- [ ] 效能優化 (目標 <2s 載入)
- [ ] 匿名短回覆（F-003 Level 2，含安全掃描）
- [ ] 情緒日記連續紀錄 (F-016)
- [ ] 情緒共鳴推薦 (F-017)
- [ ] NLP 模型第一次重訓（使用 Alpha/Beta 階段標註數據）
- [ ] 🔒 安全審計 #2：上線前全面安全測試

## V1.5 — 成長版本 (Month 8–10)
- [ ] 聚合引擎 V2 (時間衰減 + 動態排程)
- [ ] 心情天氣分享卡片 (F-015) — 個人週報 + 城市即時天氣
- [ ] 個人情緒趨勢報告
- [ ] 自訂回應 (Premium)
- [ ] 邀請機制
- [ ] 虛擬道具系統（氣泡外觀、特效）
- [ ] 「送溫暖」虛擬禮物機制
- [ ] A/B Testing 框架
- [ ] 🔒 安全審計 #3：季度安全審查 + 機制效能評估

## V2.0 — 擴展版本 (Month 11–14)
- [ ] 城市心情報告 (公開)
- [ ] 品牌打卡站
- [ ] 匿名對話 (心情串聯，含即時安全掃描)
- [ ] 多語言支援 (日/英) + 多語言安全審核
- [ ] Pro 方案
- [ ] 節日特別版分享卡片
- [ ] 🔒 安全審計 #4 + 外部專家年度審計

## V3.0 — 平台化 (Month 15+)
- [ ] B2B 數據 API
- [ ] 開發者生態
- [ ] 國際市場上線（含在地化心理援助資源）
- [ ] AI 情緒趨勢預測
- [ ] 🔒 安全審計 #5 + SOC 2 合規準備
```

---

## 附錄

```markdown
# Appendix A — 術語表

| 術語 | 定義 |
|------|------|
| 心情文 (Mood Post) | 用戶在特定地點發出的一則情緒表達 |
| 心情氣泡 (Mood Bubble) | 地圖上代表單一心情文的視覺元素 |
| 氣團 (Mood Cluster) | 多個心情氣泡在中層縮放下的聚合體 |
| 氣象區塊 (Weather Zone) | 區域級的情緒聚合區域，用天氣圖示表示 |
| 罐頭回應 (Canned Response) | 預設的快速回應文字 |
| H3 Cell | Uber H3 系統中的一個六邊形地理網格 |
| Valence | 情緒愉悅度 (-1 負面 ~ +1 正面) |
| Arousal | 情緒激動度 (-1 低能量 ~ +1 高能量) |
| 時間衰減 (Time Decay) | 越舊的心情文在聚合中權重越低的機制 |

---

# Appendix B — 心情分類學

## 核心情緒標籤 (V1)
| 標籤 | 英文 Key | Valence | Arousal | 天氣映射 |
|------|----------|---------|---------|----------|
| 開心 | happy | +0.8 | +0.3 | ☀️ |
| 興奮 | excited | +0.7 | +0.9 | 🔥 |
| 感恩 | grateful | +0.9 | -0.2 | 🌈 |
| 平靜 | peaceful | +0.5 | -0.7 | 🌤 |
| 疲憊 | tired | -0.3 | -0.6 | ⛅ |
| 焦慮 | anxious | -0.5 | +0.7 | 🌪 |
| 難過 | sad | -0.7 | -0.5 | 🌧 |
| 生氣 | angry | -0.8 | +0.9 | ⛈ |
| 孤獨 | lonely | -0.6 | -0.4 | 🌫 |
| 有成就感 | accomplished | +0.7 | +0.5 | ⭐ |
| 迷茫 | confused | -0.2 | +0.2 | 🌥 |
| 期待 | hopeful | +0.6 | +0.4 | 🌅 |

---

# Appendix C — 設計語彙

## 色彩系統
### 品牌色
- Primary: #4A90D9 (信任藍)
- Secondary: #FFD93D (溫暖黃)
- Accent: #FF6B9D (關懷粉)

### 情緒色譜
(參照 08 文件色彩映射表)

### 中性色
- Background: #0F1923 (深夜藍黑)
- Surface: #1A2634
- Text Primary: #E8ECF1
- Text Secondary: #8B9DAF

## 字型
- 標題：Noto Sans TC Bold
- 內文：Noto Sans TC Regular
- 數字：SF Mono / Roboto Mono

## 圓角
- 氣泡：full rounded (50%)
- 卡片：16px
- 按鈕：12px

## 動畫時長
- 微互動：150ms
- 頁面過渡：300ms
- 氣泡脈動：2s loop
- 縮放聚合：500ms

---

# Appendix D — 競品分析

| 產品 | 定位 | 優勢 | 劣勢 | 與 MoodMap 差異 |
|------|------|------|------|----------------|
| Whisper | 匿名社交 | 用戶基數大 | 非地理核心、內容品質差 | 我們以地圖為核心體驗 |
| Zenly (已關) | 位置社交 | 即時位置互動 | 熟人社交、隱私爭議 | 我們匿名且聚焦情緒 |
| How We Feel | 情緒追蹤 | 科學基礎 | 純個人工具、無社交 | 我們加入社交與地理 |
| Woebot | AI 心理健康 | 專業對話 | 非社交、較臨床 | 我們是社群而非治療 |
| Daylio | 心情日記 | 簡潔記錄 | 純個人、無地理 | 我們外顯化為地圖 |
```

---

這套文件架構涵蓋了從產品概念到技術落地到商業營運的完整鏈路。建議的推進方式是先把 01（願景）、03（功能規格 P0 部分）、05（技術架構）、06（資料庫）這四份寫到可執行的程度，就可以開始 MVP 開發了。其他文件可以隨著產品階段逐步填充。

需要我幫你深入展開其中任何一份文件的完整內容嗎？