# Phase 1 — Beta 公測 (V0.5)

> **版本**：V0.5 Beta  
> **時程**：Month 4–5  
> **目標**：上線聚合引擎 + 即時推送 + 環境情緒層，解決冷啟動問題，完成首次外部安全審計  
> **用戶規模**：澳門與香港共 500 位種子用戶（邀請制）  
> **前置條件**：Phase 0 所有 Go/No-Go 項目通過  
> **測試地區**：澳門、香港（見 [test-regions-macao-hongkong.md](test-regions-macao-hongkong.md)）

---

## 一、階段目標

1. 上線心情氣象區塊，驗證「縮放地圖看見區域情緒天氣」的核心視覺體驗
2. WebSocket 即時推送，讓用戶感受「活的地圖」
3. 環境情緒層上線，確保新用戶看到的地圖不空蕩
4. 平台情緒安全儀表板上線，即時監控全平台安全狀況
5. 完成首次外部心理健康專家安全審計

---

## 二、交付項目

### 2.1 核心功能

| ID | 功能 | 描述 | 參照文件 |
|----|------|------|----------|
| F-004 | 心情氣象區塊 | H3 六邊形聚合 + 天氣圖示 + 色溫填色 + 點擊展開摘要 | 08-map §8.2, 10-aggregation |
| — | 聚合引擎 V1 | H3 三層 resolution (7/5/3) 聚合計算 + Redis 快取 | 10-aggregation §10.2–10.5 |
| — | 縮放過渡動畫 | Zoom 15→14→12→11 氣泡→氣團→區塊的流暢過渡動畫 | 08-map §8.5 |
| — | WebSocket 即時更新 | 附近新心情推送 + 區域聚合更新推送 | 09-realtime §9.1–9.2 |
| — | 推播通知 | 收到回應 Push + 附近新心情 In-app + 區域氣象變化 opt-in | 09-realtime §9.3 |
| — | 環境情緒層 | AI 生成背景氛圍氣泡（根據天氣/時間/地點），明確標記為「環境氛圍」 | 16-gtm §16.1 Phase 0 |

### 2.2 安全防護升級

| ID | 功能 | 描述 | 參照文件 |
|----|------|------|----------|
| — | 平台情緒安全儀表板 v1 | 即時監控 6 項指標 + 區域關懷模式自動觸發 + 全平台關懷模式 | 11-moderation §11.8 |
| — | 區域關懷模式 | 特定區域負面 > 70% → 關懷卡片 + 正向加權 3x + 審核加強 | 11-moderation §11.8 |
| — | 傳染效應防護實戰 | Layer 4 在 500 用戶環境中驗證，模仿型內容偵測運作正常 | 11-moderation §11.2 Layer 4 |
| — | 安全審計 #1 | 外部心理健康專家審閱安全機制並出具報告 | 11-moderation §11.9 |

### 2.3 技術架構升級

| 項目 | 內容 | 參照文件 |
|------|------|----------|
| Kafka | 事件匯流排上線（mood.created, reaction.added, aggregation.updated） | 05-tech §5.3 |
| WebSocket | Socket.IO 連線管理 + H3 cell channel 分配 | 09-realtime §9.1 |
| 聚合 Worker | 基於 Kafka 的聚合計算 worker + 動態排程（熱區 2min / 一般 5min / 冷區 15min） | 10-aggregation §10.4 |
| Redis Cluster | 聚合快取 + H3 分層存儲 | 05-tech §5.2 |
| Staging 環境 | K8s staging 環境就緒，模擬 production | 13-devops §13.1 |

### 2.4 營運準備

| 項目 | 內容 |
|------|------|
| 種子用戶招募 | 500 人（PTT / Dcard / 大學心理健康社團） |
| 邀請碼機制 | 每位用戶 3 個邀請碼 |
| 預埋內容 | 團隊每日各區發文，維持 > 5 則/km²/日（澳門半島/氹仔、香港港島/九龍/新界東西核心區） |
| 環境情緒層 AI | 模型就緒 + 背景氛圍氣泡生成正常 |
| 安全審計專家 | 1 位外部心理健康專家完成審閱並出具書面報告 |

---

## 三、驗收標準

### 3.1 功能驗收

| # | 驗收項目 | 通過條件 | 驗證方式 |
|---|---------|---------|---------|
| A01 | 聚合引擎計算 | H3 res-7/5/3 三層聚合正確輸出，dominant_mood / avg_valence / weather_icon 準確 | 單元測試 + 人工抽查 |
| A02 | 氣象區塊顯示 | Zoom ≤ 11 顯示 H3 六邊形填色 + 天氣圖示，填色與 valence 對應正確 | 手動測試 + 截圖比對 |
| A03 | 縮放動畫 | 氣泡→氣團→區塊三階過渡動畫流暢（≤ 500ms），無閃爍/跳動 | 手動測試（iOS + Android） |
| A04 | 區域摘要卡片 | 點擊氣象區塊展開摘要，包含主導情緒 / 情緒分佈 / 心情文數量 | 手動測試 |
| A05 | WebSocket 推送 | 用戶 A 發文後，附近在線的用戶 B 在 5 秒內看到新氣泡出現 | 雙裝置同步測試 |
| A06 | 推播通知 | 收到回應時正確觸發 Push（5 分鐘合併），附近新心情 In-app 通知正常 | 手動測試 |
| A07 | 環境情緒層 | 空白區域顯示 AI 環境氛圍氣泡（半透明標記），與真實用戶氣泡視覺區隔 | 手動測試 |
| A08 | 環境層退場 | 真實心情文密度 > 15 則/km²/日的區域，環境氛圍氣泡自動停止顯示 | 模擬測試 |
| A09 | 聚合排程 | 熱區 ≤ 2min / 一般 ≤ 5min / 冷區 ≤ 15min 完成聚合更新 | 計時測試 |
| A10 | 過去 7 天累積 | 初期地圖展示過去 7 天累積數據（非僅即時），密度充足 | 手動驗證 |

### 3.2 安全防護驗收

| # | 驗收項目 | 通過條件 | 驗證方式 |
|---|---------|---------|---------|
| S01 | 安全儀表板 | 6 項即時指標正確顯示 + 告警/緊急閾值觸發正常 | 後台手動 + 模擬觸發 |
| S02 | 區域關懷模式 | 特定區域負面 > 70% 時，自動觸發關懷卡片 + 正向 3x 加權 | 模擬注入測試 |
| S03 | 全平台關懷模式 | 全平台負面 > 70% 時，首頁橫幅 + 推播加入資源連結 | 模擬注入測試 |
| S04 | Phase 0 安全保持 | 所有 Phase 0 安全驗收項目 (S01-S17) 回歸測試通過 | 安全回歸套件 |
| S05 | 外部安全審計 | 外部心理健康專家完成審閱，出具書面報告，無「高風險」未解項 | 審計報告 |
| S06 | 安全報告 v1 | 首份平台安全週報產出，格式與內容完整 | 報告審查 |

### 3.3 效能驗收

| # | 驗收項目 | 通過條件 | 驗證方式 |
|---|---------|---------|---------|
| P01 | 聚合查詢效能 | GET /aggregations P95 < 500ms（含 Redis 命中） | 壓力測試 |
| P02 | WebSocket 延遲 | 發文 → 附近用戶收到推送 ≤ 5 秒 | 端到端計時 |
| P03 | 併發支撐 | 500 同時線上用戶，API 錯誤率 < 0.1% | 壓力測試 |
| P04 | 地圖渲染 | 500 個氣泡 + 聚合區塊的地圖渲染 < 500ms | 前端效能測試 |

---

## 四、Go / No-Go 決策

### 必須全部通過：
- [ ] S01–S06 安全驗收全部通過
- [ ] S05 外部安全審計無高風險未解項
- [ ] A01–A10 功能驗收全部通過
- [ ] 澳門與香港核心區真實 + 環境氛圍氣泡密度 > 10 則/km²（視覺豐富度）

### 可帶條件通過：
- P01–P04 效能指標允許 ±15% 偏差（Beta 階段用戶規模有限）
- 推播通知合併邏輯可簡化為 V1.0 完善

---

## 五、階段產出文件

- [ ] Beta 測試報告
- [ ] 安全審計 #1 報告（外部專家版）
- [ ] 首批平台安全週報
- [ ] 用戶回饋摘要（500 人規模）
- [ ] 聚合引擎效能基準報告
- [ ] Phase 2 進入準備確認書
